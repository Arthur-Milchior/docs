

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Troubleshooting &mdash; Jina Documentation 0.0.5 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/main.css" type="text/css" />

<!--  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">-->


  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FAQ for End-Users" href="faq/user.html" />
    <link rel="prev" title="JEP 2 — Supporting Docker Container in Flow API" href="jep/jep-2/main.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Jina Documentation
          

          
          </a>

          
            
            
              <div class="version">
                0.0.5
              </div>
            
          


          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install/via-pip.html">Install Jina via <code class="docutils literal notranslate"><span class="pre">pip</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="install/via-docker.html">Install Jina via Docker Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/on-rasp-linux.html">Install Jina on Raspberry Pi and other Linux Systems</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hub/main.html">Using Jina Pod with Docker Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="remote/main.html">Using Jina Pod Remotely</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli/exit.html">Gracefully Exit Jina</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cli/main.html">Jina Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/jina.html">Jina Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="yaml/yaml.html">Jina YAML Syntax Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="proto/main.html">Jina Protobuf Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="envs.html">OS Environment Variables Used in Jina</a></li>
</ul>
<p class="caption"><span class="caption-text">Extending Jina</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="extend/executor.html">Guideline When Adding New Executor</a></li>
<li class="toctree-l1"><a class="reference internal" href="extend/executor-encoder.html">General Guideline When Adding New Executor</a></li>
<li class="toctree-l1"><a class="reference internal" href="hub/publish-your-pod-image.html">Publish Your Pod Image to Jina Hub</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing Guideline</a></li>
<li class="toctree-l1"><a class="reference internal" href="jep/main.html">Jina Enhancement Proposals (JEP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Miscs</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Frequently Asked Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq/user.html">FAQ for End-Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq/dev.html">FAQ for Developers</a></li>
</ul>
<p class="caption"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html">Release Cycle</a></li>
<li class="toctree-l1"><a class="reference internal" href="RELEASE.html#friday-release">Friday Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Change Logs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Jina Documentation</a>
        
      </nav>

      <div class="card table-of-contents">
          <span class="card-title">Table of Contents</span>
            <div class="card-content">
            <ul>
<li><a class="reference internal" href="#">Troubleshooting</a><ul>
<li><a class="reference internal" href="#check-if-docker-swarm-stack-runs-successfully">Check if docker swarm/stack runs successfully</a></li>
<li><a class="reference internal" href="#investigate-the-reason-of-a-failed-service">Investigate the reason of a failed service</a></li>
<li><a class="reference internal" href="#delete-a-failed-service">Delete a failed service</a></li>
<li><a class="reference internal" href="#locate-internal-errors-by-looking-at-logs">Locate internal errors by looking at logs</a></li>
</ul>
</li>
</ul>

            </div>
        <a href="https://github.com/jina-ai/jina/">
          <span class="toc-card-footer">
            <span>Visit us on Github</span>
          </span>
        </a>
      </div>

      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation" class="nav-bar-header">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Troubleshooting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  
<div role="search" class="nav-bar-search">
  <form id="rtd-search-form" class="wy-form doc-searchbox" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

</div>
<hr/>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="check-if-docker-swarm-stack-runs-successfully">
<h2>Check if docker swarm/stack runs successfully<a class="headerlink" href="#check-if-docker-swarm-stack-runs-successfully" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker service ls
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ID                  NAME                              MODE                REPLICAS            IMAGE                                           PORTS
j7b533zxmzg5        jina-swarm-2654_encoder           replicated          0/1                 ccr.ccs.tencentyun.com/jina/aipd-jina:master
0vlxu4acg1ph        jina-swarm-2654_income-proxy      replicated          0/1                 ccr.ccs.tencentyun.com/jina/aipd-jina:master    *:4962-&gt;4962/tcp
equqrhsn7pky        jina-swarm-2654_indexer           replicated          0/3                 ccr.ccs.tencentyun.com/jina/aipd-jina:master
nd7euo7mcpa9        jina-swarm-2654_middleman-proxy   replicated          0/1                 ccr.ccs.tencentyun.com/jina/aipd-jina:master
ssdlk9gzmggw        jina-swarm-2654_outgoing-proxy    replicated          0/1                 ccr.ccs.tencentyun.com/jina/aipd-jina:master    *:4963-&gt;4963/tcp
xgxeetyhos6t        my-jina_encoder                   replicated          1/1                 ccr.ccs.tencentyun.com/jina/aipd-jina:a799a0f
zny37400p225        my-jina_income-proxy              replicated          1/1                 ccr.ccs.tencentyun.com/jina/aipd-jina:a799a0f   *:8598-&gt;8598/tcp
taqqg6qwrxlw        my-jina_indexer                   replicated          3/3                 ccr.ccs.tencentyun.com/jina/aipd-jina:a799a0f
j96gnny8ysbn        my-jina_middleman-proxy           replicated          1/1                 ccr.ccs.tencentyun.com/jina/aipd-jina:a799a0f
e28spnuksjw8        my-jina_outgoing-proxy            replicated          1/1                 ccr.ccs.tencentyun.com/jina/aipd-jina:a799a0f   *:8599-&gt;8599/tcp
</pre></div>
</div>
<p>In the above example, we started two swarms, i.e. <code class="docutils literal notranslate"><span class="pre">jina-swarm-2654</span></code> and <code class="docutils literal notranslate"><span class="pre">my-jina</span></code>. Unfortunately, <code class="docutils literal notranslate"><span class="pre">jina-swarm-2654</span></code> fails to start and is not running at all. But how can one tell that?</p>
<p>Note the column <code class="docutils literal notranslate"><span class="pre">REPLICAS</span></code>, which indicates the number of running service (versus the number of required services). <code class="docutils literal notranslate"><span class="pre">jina-swarm-2654</span></code> gives <code class="docutils literal notranslate"><span class="pre">0/0</span></code> for all services. This suggests the swarm fails to start. The next step is to investigate the reason.</p>
</div>
<div class="section" id="investigate-the-reason-of-a-failed-service">
<h2>Investigate the reason of a failed service<a class="headerlink" href="#investigate-the-reason-of-a-failed-service" title="Permalink to this headline">¶</a></h2>
<p>One can not print out all logs of a docker swarm. Instead, one can inspect service by service, e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker service ps jina-swarm-2654_encoder --format <span class="s2">&quot;{{json .Error}}&quot;</span> --no-trunc
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&quot;\&quot;invalid mount config for type \&quot;bind\&quot;: bind source path does not exist: /data/han/test-shell/output_data\&quot;&quot;
&quot;\&quot;invalid mount config for type \&quot;bind\&quot;: bind source path does not exist: /data/han/test-shell/output_data\&quot;&quot;
&quot;\&quot;invalid mount config for type \&quot;bind\&quot;: bind source path does not exist: /data/han/test-shell/output_data\&quot;&quot;
&quot;\&quot;invalid mount config for type \&quot;bind\&quot;: bind source path does not exist: /data/han/test-shell/output_data\&quot;&quot;
</pre></div>
</div>
<p>Now the reason is clear, <code class="docutils literal notranslate"><span class="pre">output_data</span></code> does not exist when starting the swarm. But why there are duplicated lines there? This is because docker swarm did three retries before giving up on starting this service, where each time it met the same problem. Thus four duplicated lines in total.</p>
</div>
<div class="section" id="delete-a-failed-service">
<h2>Delete a failed service<a class="headerlink" href="#delete-a-failed-service" title="Permalink to this headline">¶</a></h2>
<p>Now that the reason is clear, we can delete the failed service and release the resources.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker stack rm jina-swarm-2654
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Removing service jina-swarm-2654_encoder
Removing service jina-swarm-2654_income-proxy
Removing service jina-swarm-2654_indexer
Removing service jina-swarm-2654_middleman-proxy
Removing service jina-swarm-2654_outgoing-proxy
Removing network jina-swarm-2654_jina-net
</pre></div>
</div>
</div>
<div class="section" id="locate-internal-errors-by-looking-at-logs">
<h2>Locate internal errors by looking at logs<a class="headerlink" href="#locate-internal-errors-by-looking-at-logs" title="Permalink to this headline">¶</a></h2>
<p>Sometime the service fails to start but <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">service</span> <span class="pre">ps</span></code> gives no error,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker service ps jina-swarm-4254_encoder --format <span class="s2">&quot;{{json .Error}}&quot;</span> --no-trunc
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&quot;&quot;
</pre></div>
</div>
<p>Or it shows an error that is not explanatory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;\&quot;task: non-zero exit (2)\&quot;&quot;</span>
</pre></div>
</div>
<p>Often in this case, the service fails to start <em>not</em> due tothe docker config, but due to the JINA internal error. To see that,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker service logs jina-swarm-4254_income-proxy
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jina-swarm-4254_income-proxy.1.yj5v8n4dhfgv@VM-0-3-ubuntu    <span class="p">|</span>                   <span class="o">[</span>--proxy-type <span class="o">{</span>BS,Dict,MapProxyService,Message,MessageHandler,ProxyService,ReduceProxyService,defaultdict<span class="o">}]</span>
jina-swarm-4254_income-proxy.1.yj5v8n4dhfgv@VM-0-3-ubuntu    <span class="p">|</span>                   <span class="o">[</span>--batch-size BATCH_SIZE<span class="o">]</span> <span class="o">[</span>--num-part NUM_PART<span class="o">]</span>
jina-swarm-4254_income-proxy.1.kmgk21qo6m0n@VM-0-3-ubuntu    <span class="p">|</span>                   <span class="o">[</span>--proxy-type <span class="o">{</span>BS,Dict,MapProxyService,Message,MessageHandler,ProxyService,ReduceProxyService,defaultdict<span class="o">}]</span>
jina-swarm-4254_income-proxy.1.w04d552cuj93@VM-0-3-ubuntu    <span class="p">|</span> jina proxy: error: argument --batch-size: invalid int value: <span class="s1">&#39;&#39;</span>
jina-swarm-4254_income-proxy.1.kmgk21qo6m0n@VM-0-3-ubuntu    <span class="p">|</span>                   <span class="o">[</span>--batch-size BATCH_SIZE<span class="o">]</span> <span class="o">[</span>--num-part NUM_PART<span class="o">]</span>
</pre></div>
</div>
<p>One can now clearly see that the error comes from an incorrectly given <code class="docutils literal notranslate"><span class="pre">--batch-size</span></code>, which throws from JINA CLI.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="faq/user.html" class="btn btn-neutral float-right" title="FAQ for End-Users" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="jep/jep-2/main.html" class="btn btn-neutral float-left" title="JEP 2 — Supporting Docker Container in Flow API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Jina AI and its lovely contributors

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>